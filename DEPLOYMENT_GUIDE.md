# FoundR - Cloudflare Pages Deployment Guide

## Current Status

**All code is pushed to GitHub and configured correctly!**

- Repository: https://github.com/gogs1998/FoundR.git
- Latest commit: b8f1cb5 "Fix Remix config for Cloudflare Pages - use default build output"
- Cloudflare Pages will automatically deploy from main branch

## What You Need to Do in Cloudflare Dashboard

### 1. Configure Build Settings

Go to your Cloudflare Pages project settings and verify:

- **Build command**: `npm run build`
- **Build output directory**: `build/client`
- **Root directory**: (leave empty)
- **Node version**: 18 (already set via .nvmrc)

### 2. Add Environment Variables

Go to **Settings** → **Environment variables** and add:

**Production & Preview environments:**

```
OPENROUTER_API_KEY=<your-openrouter-api-key>
VIBESDK_URL=https://vibesdk-production1.gogs1998.workers.dev
```

**Note**: Get your OpenRouter API key from https://openrouter.ai/keys

### 3. Trigger Deployment

- Go to **Deployments** tab
- Click **Create deployment**
- Or wait for automatic deployment from the latest push

## What Was Fixed

### Issue Timeline

1. **Reserved ASSETS binding** - Fixed by simplifying wrangler.toml
2. **Old commit being deployed** - Fixed by triggering new commits
3. **package-lock.json sync issues** - Fixed by removing lockfile (let Cloudflare generate it)
4. **No build command** - Fixed by configuring in Cloudflare Dashboard
5. **Wrong build output directory** - Fixed by correcting remix.config.js

### Final Configuration

**wrangler.toml:**
```toml
name = "foundr"
compatibility_date = "2025-01-01"
pages_build_output_dir = "build/client"
```

**remix.config.js:**
```javascript
export default {
  ignoredRouteFiles: ["**/.*"],
  serverModuleFormat: "esm",
  serverPlatform: "cloudflare",  // Key fix: use Cloudflare defaults
  tailwind: true,
  postcss: true,
  future: {
    v3_fetcherPersist: true,
    v3_relativeSplatPath: true,
    v3_throwAbortReason: true,
  },
};
```

**.nvmrc:**
```
18
```

## Testing After Deployment

Once deployed, visit your Cloudflare Pages URL and test:

1. **Homepage loads** - Should see purple gradient UI with "Start Building" button
2. **Question flow** - Click "Start Building" and type a request
3. **AI responds** - Should see questions from the AI
4. **Code generation** - Answer questions, should generate code
5. **Deployment** - Should deploy to VibeSDK

## Expected Build Output

When the build succeeds, you should see:

```
> remix build
info  building...
info  built (14-16s)
✓ Build successful
```

And the output directory structure:
```
build/
├── client/          ← This is what Cloudflare Pages serves
│   ├── index.html
│   ├── assets/
│   └── ...
└── server/
    └── index.js
```

## Troubleshooting

### Build Still Fails

If you see "Output directory build/client not found":
1. Check build logs in Cloudflare dashboard
2. Verify build command is `npm run build` (not `npm ci && npm run build`)
3. Ensure Node version is 18

### API Key Issues

If OpenRouter doesn't work:
1. Verify OPENROUTER_API_KEY is set in both Production and Preview
2. Check the key hasn't expired
3. Test API key: https://openrouter.ai/

### VibeSDK Connection Issues

If deployment to VibeSDK fails:
1. Verify VIBESDK_URL is correct
2. Check VibeSDK instance is running at https://vibesdk-production1.gogs1998.workers.dev
3. Test the endpoint directly

## What's Next

After successful deployment:

1. **Test the full flow** - Build an app end-to-end
2. **Add custom domain** - In Pages settings → Custom domains
3. **Add database** - Set up D1 for storing user apps
4. **Add authentication** - Implement Clerk for user accounts
5. **Monitor usage** - Check analytics in Cloudflare dashboard

## Architecture

FoundR consists of:

- **Frontend**: Remix v2 React app with Tailwind CSS
- **AI**: OpenRouter (DeepSeek model) for conversations and code generation
- **Deployment**: VibeSDK backend for running generated apps
- **Hosting**: Cloudflare Pages (serverless, auto-scaling)

## Files Structure

```
FoundR/
├── app/
│   ├── routes/
│   │   └── _index.tsx          # Main landing page
│   ├── lib/
│   │   ├── question-agent.ts   # AI conversation logic
│   │   ├── code-generator.ts   # Code generation prompts
│   │   └── simple-deploy.ts    # VibeSDK integration
│   └── root.tsx                # App shell
├── public/                      # Static assets
├── build/                       # Generated by npm run build
│   └── client/                  # Cloudflare Pages serves this
├── remix.config.js              # Remix configuration
├── wrangler.toml                # Cloudflare Pages config
├── package.json                 # Dependencies
├── .nvmrc                       # Node version (18)
└── .gitignore                   # Git exclusions
```

## Support

If you encounter issues:

1. Check Cloudflare Pages deployment logs
2. Review this guide's troubleshooting section
3. Verify all environment variables are set
4. Ensure latest code is pushed to GitHub

---

**Current Status**: Ready to deploy! Just add environment variables in Cloudflare dashboard and trigger deployment.
